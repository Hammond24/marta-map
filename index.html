<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>BDC - MARTA</title>
    <style>
       #map {
        height: 500px;
        width: 100%;
       }
    </style>
  </head>
  <body>
    <img src="marta.png" alt="MARTA Logo" height="100" width="300">
    <div id="map"></div>
    <script>
      function initMap() {
        var georgiaTech = {lat: 33.7756, lng: -84.3963};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 11,
          center: georgiaTech
        });
        var xhttp = new XMLHttpRequest();
        var curr_markers = [];
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            var data = JSON.parse(this.responseText);
            var buses = data.buses;
            var oldBuses = data.oldBuses;
         	//    for (var i = 0; i < curr_markers.length; i++) {
	        //   curr_markers[i].setMap(null);
	        // }
          for (var i = 0; i < curr_markers.length; i++) {
            curr_markers[i].setMap(null);
          }
	        curr_markers = [];
            for (var i = 0; i < 5; i++) {
            	var pos = {lat: parseFloat(buses[i].LATITUDE), lng: parseFloat(buses[i].LONGITUDE)};
            	console.log(pos);
            	var marker = new google.maps.Marker({
          			position: pos,
          			map: map,
          			icon: {
    				      url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
    				    }
        		});
        		curr_markers.push(marker);
            }
            for (var i = 0; i < 5; i++) {
            	var pos = {lat: parseFloat(oldBuses[i].LATITUDE), lng: parseFloat(oldBuses[i].LONGITUDE)};
            	console.log(pos);
            	var marker = new google.maps.Marker({
          			position: pos,
          			map: map,
                icon: {
                  url: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
                }
        		});
        		curr_markers.push(marker);
            }
          }
        };
        xhttp.open("GET", "http://localhost:8080/GetBuses", true);
        xhttp.send();
        
        var ajax_call = function() {
		      xhttp.open("GET", "http://localhost:8080/GetBuses", true);
          xhttp.send();
    		};

    		var interval = 1000 * 60 * 0.3; // where X is your every X minutes

    		setInterval(ajax_call, interval);
      };
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=[API_KEY]&callback=initMap">
    </script>
    </body>
  </html>
