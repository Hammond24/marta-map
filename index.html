<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>BDC - MARTA</title>
    <style>
    #map {
      height: 500px;
      width: 100%;
    }
  </style>
</head>
<body>
  <img src="marta.png" alt="MARTA Logo" height="100" width="300">
  <div id="map"></div>
  <script>

    function initMap() {
      var georgiaTech = {lat: 33.7756, lng: -84.3963};
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 11,
        center: georgiaTech
      });

      var infowindow = new google.maps.InfoWindow();

      var marker = new google.maps.Marker({
        position: georgiaTech,
        map: map
      });

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var buses = JSON.parse(this.responseText);

          for(i = 0; i < buses.length; i++) {
            var latitude = parseFloat(buses[i].LATITUDE);
            var longitude = parseFloat(buses[i].LONGITUDE);

            var marker1 = new google.maps.Marker({
              position: {lat: latitude, lng: longitude},
              map: map
            });

            var message = '<div><strong>' + buses[i].TIMEPOINT
              + '</strong><br>@ ' + buses[i].MSGTIME + '<br>Route '
              + buses[i].ROUTE + '<br>' + '(' + latitude + ' , ' + longitude
              + ')' + '</div>';

            attatchInfo(marker1, message);
          }
        }
        };
        xhttp.open("GET", "busData.json", true);
        xhttp.send();

        function attatchInfo(marker, info) {
          google.maps.event.addListener(marker, 'click', function() {
              infowindow.setContent(info);
              infowindow.open(map, marker);
            });
        };
      };
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBpWRyIAxW2rc8HgZssAWARXef2c7qEGgU&callback=initMap">
  </script>
    </body>
  </html>
